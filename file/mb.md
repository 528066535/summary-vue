
    模板编译是在拿到 vnode 之前所做的事情。

### 一. 介绍

模板编译可以识别我们平时写的各种指令，等复杂的语法，并生成渲染函数，渲染函数再生成新的vnode。

#### 渲染函数生成过程。

渲染函数是通过两个步骤生成的，首先将模板解析成AST（抽象语法树），然后再使用AST生成渲染函数。

在生成渲染函数中，可以进行优化，标记静态节点，这样就不需要重复渲染了。

总结一下，模板生成渲染函数，会先生成AST，然后再经静态节点的标记，再生成可渲染成渲染函数的代码，最后就根据这部分代码生成渲染函数了。

### 二. 如何生成AST

vue源码中有一个 parse 函数，他负责把模板解析成AST结构。再解析HTML的时候会触发 start（当解析到标签的开始位置时，触发），end（当解析到
标签结束位置时触发），chars（当解析到文本时，触发），comment（当解析到注释时，会触发）。其内部原理是通过栈的逻辑来解释，当触发start的
时候，会把节点推入栈中，当触发end时，就会从栈中弹出一个节点。

具体的过程则是通过while循环，正则判断是文本还是注释还是标签还是条件注释，DOCTYPE，来生成具体的AST。

### 三. 优化

渲染成AST后，会标记静态静态，这么做的目的是为了

1. 每次渲染的时候，不需要重新渲染静态节点，及其子节点。

2. 不需要要新的老的节点进行Vnode对比，也就是说不需要打补丁了。

具体过程则是会循环判断，如果一个节点是静态节点，则用一个字段来标记，再循环其子节点，如果子节点有非静态节点，则其子节点的父节点则标记为
非静态节点。

### 四. 生成可以渲染成Vnode的函数

模板编译的最后一步就是生成代码字符串。而节点有不同的类型，对应不同的函数。包括元素节点，文本节点与注释界定啊。


